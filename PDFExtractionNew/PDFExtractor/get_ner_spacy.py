# -*- coding:utf-8 -*-

import spacy, json
import yake
import ast
from decouple import config
import warnings, re
import string
from nltk.stem.wordnet import WordNetLemmatizer
from extract_categories import ExtractCategories

warnings.filterwarnings("ignore")


class NerSpacy:
    def __init__(self):
        self.spacy_nlp = spacy.load("en_core_web_sm")
        self.extract_categories = ExtractCategories()
        self.language = config("language")
        self.max_ngram_size = int(config("max_ngram_size"))
        self.numOfKeywords = int(config("numOftopKeywords"))
        self.exclude_ner = config("EXCLUDE_NER")
        self.exclude_StopWords = [str(sw).lower().strip() for sw in ast.literal_eval(config("StopWords"))]
        self.obj_word_lemma = WordNetLemmatizer()

    def extract_ner(self, stringtext):
        dict_list = {}
        Measures = []
        Actions = []
        Goals = []
        try:
            stringtext = str(stringtext).lower()
            # stringtext = ' '.join([st for st in stringtext.split() if st not in str(string.punctuation)])
            doc = self.spacy_nlp(stringtext.strip())
            for i in doc.ents:
                exclud_ner_list = [m.lower().strip() for m in ast.literal_eval(self.exclude_ner)]
                if str(i.label_).lower() not in exclud_ner_list:
                    try:
                        dict_list[str(i.label_)].append(str(i.lemma_))
                        dict_list[str(i.label_)] = list(set(dict_list[str(i.label_)]))
                    except:
                        dict_list[str(i.label_)] = [str(i.lemma_)]
            categorieslist=self.extract_categories.process_text(stringtext)
            stringtext_new = re.sub(r'[^\w\s]', '', stringtext)
            docs = self.spacy_nlp(stringtext_new.strip())
            for token in docs:
                if (token.dep_ == "amod" and token.head.pos_ == "NOUN") or (
                        token.dep_ == "compound" and token.head.pos_ == "NOUN"):
                    if len(str(token.text).lower()) > 2 and str(
                            token.text).lower() not in self.exclude_StopWords and str(
                            token.head.text).lower() not in self.exclude_StopWords:
                        measure_kw = str(token.text).lower() + " " + str(token.head.text).lower()
                        if len(measure_kw) < 30:
                            Measures.append(measure_kw)
                elif token.dep_ == "dobj" and token.head.pos_ == "VERB":
                    action_kw = self.obj_word_lemma.lemmatize(str(token.head.text).lower(), "v") + " " + str(
                        token.text).lower()
                    if len(action_kw) < 50:
                        Actions.append(action_kw)
                    chtok = [child for child in token.children]
                    if len(chtok) >= 2:
                        for tok_goal in self.spacy_nlp(str(str(chtok[1]).strip().lower())):
                            if tok_goal.head.pos_ == "NOUN" or tok_goal.head.pos_ == "ADJ" or tok_goal.head.pos_ == "VERB":
                                goas_text = self.obj_word_lemma.lemmatize(str(token.head.text).lower(),
                                                                          "v") + " " + str(
                                    chtok[1]).strip().lower() + " " + str(
                                    token.text).lower()
                                if len(action_kw) < 100:
                                    Goals.append(goas_text)
            dict_list["MEASURE"] = list(set(Measures))
            dict_list["ACTION"] = list(set(Actions))
            dict_list["GOALS"] = list(set(Goals))
            dict_list["CATEGORIES"]=list(set(categorieslist))
        except Exception as ex:
            pass
        return dict_list

    def extract_weight(self, text):
        values = []
        if text:
            custom_kw_extractor = yake.KeywordExtractor(lan=self.language, n=self.max_ngram_size, dedupLim=0.9,
                                                        dedupFunc='seqm',
                                                        windowsSize=1, top=self.numOfKeywords, features=None)
            keywords = custom_kw_extractor.extract_keywords(text)
            if len(keywords) > 10:
                for val in keywords:
                    temp = [val[1], val[0]]
                    values.append(temp)
        return values


if __name__ == "__main__":
    obj = NerSpacy()
    text = "GRI Index 2018 Social Responsibility Report General Disclosures Disclosure 102-1 Description Name of the organization Reference or additional information McKinsey & Company 102-2 102-3 102-4 102-5 102-6 Activities, brands, products, and services Overview of McKinsey & Company Location of headquarters McKinsey Fact Sheet Location of operations Locations Ownership and legal form McKinsey Fact Sheet Markets served Locations: 130+ cities, 65+ countries Functions: 12 Business Functions Industries: 21 Industries 2018 GRI Index > General Disclosures McKinsey & Company 2 2018 GRI Index > General Disclosures General Disclosures Disclosure 102-7 Description Scale of the organization Reference or additional information McKinsey Fact Sheet In 2018, McKinsey had revenues in excess of $10 Billion. Change that Matters See also our Locations Functions Industries 102-8 Information on employees and other workers As noted in our McKinsey Fact Sheet, we have approximately 30,000 colleagues, our people speak more than 130 languages and represent over 130 citizenships. McKinsey offers colleagues multiple opportunities for flexibility. Nearly 8% of our colleagues (11% of consulting colleagues) worked part-time at least some period in 2018. In addition, we are supported by a pool of external workers globally, who provide specialized expertise or capacity on an as-needed basis. More information about women at McKinsey is also available on our website. 102-9 102-10 Supply Chain See “Engaging Stakeholders” Significant changes to the organization and its supply chain No significant changes in 2018 102-11 Precautionary Principle or approach We manage our business to reduce, avoid, or mitigate risks. 2018 Social Responsibility Report, Page 34 McKinsey & Company 3 General Disclosures Disclosure 102-12 Description External initiatives 102-13 External Memberships Reference or additional information 2018 Social Responsibility Report. About Us > Diversity About Us > Sustainability See also Functions Industries 2018 Social Responsibility Report. About Us > Diversity About Us > Sustainability 102-14 Statement from decision maker 2018 Social Responsibility Report, page 2 102-16 102-17 Values, principles, standards, and norms of behavior Mechanisms for advice and concerns about ethics (Statement from Kevin Sneader) Our mission and values Code of Professional Conduct Participant Page, UN Global Compact Code of Professional Conduct 2018 Social Responsibility Report Supplier Code of Conduct 102-18 Governance structure McKinsey Fact Sheet 2018 GRI Index > General Disclosures McKinsey & Company 4 2018 GRI Index > General Disclosures General Disclosures Disclosure 102-40 Description Stakeholder groups Reference or additional information See “Stakeholder Engagement” 102-41 Collective bargaining agreements About Us: Responsible Professional Practice (Human Rights) We support the protection of internationally proclaimed human rights and employees’ rights of freedom of association and to take part in collective-bargaining processes. This information is not tracked globally, as most colleagues are not covered by collective bargaining agreements. 102-42 102-43 102-44 102-45 102-46 Identifying and selecting stakeholders See “Stakeholder Engagement” Approach to stakeholder engagement See “Stakeholder Engagement” Key topics and concerns raised See “Stakeholder Engagement” Entities included in the consolidated financial statements Locations: 130+ cities, 65+ countries Our social responsibility reporting covers all locations of our firm globally. Defining report content and topic Boundaries See “Materiality” 102-47 List of material topics See “Materiality” McKinsey & Company 5 2018 GRI Index > General Disclosures General Disclosures Disclosure 102-48 Description Restatements of information Reference or additional information No restatements of information 102-49 Changes in reporting No significant changes 102-50 Date of Reporting January 1 – December 31, 2018 Financial Year 2018 102-51 102-52 102-53 102-54 102-55 102-56 Date of most recent report June 2019 Reporting cycle Annually Contact point for questions regarding the report McKinsey welcomes your comments and questions regarding this report. Please contact us at social_responsibility@mckinsey.com Claims of reporting in accordance with the GRI Standards This report has been prepared in accordance with the GRI Standards: Core option GRI Index This document. 2018 GRI Index. External assurance We conduct external assurance of our GHG emissions. 2018 Social Responsibility Report, page 36 McKinsey & Company 6 Engaging Stakeholders (102-40, 42, 43, 44) 2018 GRI Index > General Disclosures The way in which we run our firm and the decisions that we make affect a range of stakeholders, including our clients, our people (current, alumni and future colleagues ), and our suppliers, as well as our communities. We regularly use information from various touchpoints with these stakeholders to inform our goals, shape our practices, and refine our reporting. For example: Our clients. We communicate regularly with clients through formal and informal feedback, and analyze client requests for proposals (RFPs) and other inquiries (e.g., via third-party platforms and assessments) to identify trends in the issues that are most important to them. Our people. We draw on multiple formal and informal touchpoints to incorporate the insights of current, future and previous colleagues, including surveys and town halls. We also have dedicated teams for recruiting and alumni relations who incorporate feedback from both groups. Our suppliers. We have dedicated supplier management teams who work with and hear directly from suppliers, including which procurement and other practices matter to them.  Our Supplier Code of Conduct sets out our expectations of suppliers, and via the supporting Environmental, Social, and Governance (ESG) questionnaire we gain insights into their practices, which in turn informs our activities related to procurement and supplier management. Our communities.  McKinsey has offices in over 130 cities. These communities are home to our clients and their stakeholders, and to our own people and their families. We want them to be inclusive, sustainable, and prosperous places to live and to work. We support 600+ nonprofits per year, and our interactions with them provide valuable insights into the needs of our communities from multiple perspectives. Civil society, multi-sector organizations. Our practices and reporting are informed and shaped by our participation in initiatives such as the UN Global Compact and RE100, a coalition of businesses dedicated to purchasing 100% renewable electricity by 2025. McKinsey & Company 7 Materiality (102-46, 102-47) 2018 GRI Index > General Disclosures McKinsey has a long-standing commitment to social responsibility. We recognize we have an opportunity, and a responsibility, to use our knowledge and our capabilities to help address the world’s most pressing issues, including environmental and social issues. In 2018, McKinsey became a participant in the United Nations Global Compact (UNGC), a set of ten principles covering the areas of human rights, labor, environment, and anti-corruption. Our firm’s values, the social impact we seek to achieve, and voices of our diverse stakeholders inform the material topics upon which our social responsibility strategy and reporting are based. To identify our material topics, we held working sessions with internal stakeholders, performed benchmarking across peers, referenced the Sustainability Accounting Standards Board (SASB) for the professional services sector, and incorporated external perspectives through a variety of touchpoints (e.g., client requests regarding our social responsibility practices;  requirements of third party social responsibility and sustainability assessments). The priority topics we identified include ▪ Ethics (anti-corruption) ▪ Community engagement ▪ Environmental sustainability ▪ Human rights ▪ Employee development ▪ Diversity and inclusion ▪ Supplier sustainability and diversity ▪ Data privacy and security McKinsey & Company 8 2018 GRI Index > Material Topics Ethics (anti-corruption) Disclosure Description Reference or additional information 103-1 103-2 103-3 205-2 Explanation of the material topic and its Boundary See “Materiality” Participant Page, UN Global Compact About Us: Responsible Professional Practice (anti-corruption) The management approach and its components Code of Professional Conduct, page 6 (Corruption, bribery, gifts, and entertainment), 8 (Seeking advice and raising concerns) Supplier Code of Conduct, page 3 (Anti-corruption, Gifts) 2018 Social Responsibility Report, page 52, 54, 55 Evaluation of the management approach 2018 Social Responsibility Report, page 52, 54, 55 Communication and training about anticorruption policies and procedures 2018 Social Responsibility Report, page 52, 54 Our anti-corruption policy is made available to all colleagues on our intranet. In addition we communicate important elements of our policy to our stakeholders publicly, via our Social Responsibility Report and our Code of Professional Conduct, which are available for download on McKinsey.com. Code of Professional Conduct, page 6 (Corruption, bribery, gifts, and entertainment), 8 (Seeking advice and raising concerns) McKinsey & Company 9 2018 GRI Index > Material Topics Environmental sustainability (Energy) Disclosure Description Reference or additional information 103-1 103-2 103-3 302-1 Explanation of the material topic and its Boundary See “Materiality” Participant Page, UN Global Compact Environmental Sustainability at McKinsey The management approach and its components 2018 Social Responsibility Report, pages 32-40; 34, 37 (GHG emissions, electricity) Code of Professional Conduct, page 5 (Environment) Supplier Code of Conduct, page 4 (Environment) Evaluation of the management approach 2018 Social Responsibility Report, pages 32-40 (footprint and outcomes) Energy consumption within the organization 2018 Social Responsibility Report, page 37 (transitioning to renewable electricity) Consumption of fuel: 56,717 MWh Consumption of purchased or acquired electricity: 53,180 MWh Consumption of purchased or acquired heat: 9,188 MWh Total: 119,085 MWh McKinsey & Company 10 2018 GRI Index > Material Topics Environmental sustainability (GHG Emissions) Disclosure 103-1 Description Explanation of the material topic and its Boundary Reference or additional information See “Materiality” Participant Page, UN Global Compact Environmental Sustainability at McKinsey 103-2 103-3 305-1 305-2 305-3 305-4 Since 2018, we have been carbon neutral. We are committed to reducing our greenhouse gas (GHG) emissions while offsetting all remaining emissions that we have not yet been able to eliminate. The management approach and its components 2018 Social Responsibility Report, pages 35-36, 38, 56 (GHG methodology) Code of Professional Conduct, page 5 (Environment) Supplier Code of Conduct, page 4 (Environment) Evaluation of the management approach 2018 Social Responsibility Report, pages 35-36, 38, 56-57 (Details on our Footprint) GHG Emissions (Scope 1) 2018 Social Responsibility Report, page 36 GHG Emissions (Scope 2) 2018 Social Responsibility Report, page 36 GHG Emissions (Scope 3) 2018 Social Responsibility Report, page 36 GHG emissions intensity 2018 Social Responsibility Report, page 37 Per capita GHG 305-5 GHG reduction 2018 Social Responsibility Report, page 37 Per capita reduction from 2017-18 was 11% McKinsey & Company 11 2018 GRI Index > Material Topics Employee development (1 of 2) Disclosure 103-1 Description Explanation of the material topic and its Boundary Reference or additional information See “Materiality” Participant Page, UN Global Compact About Us > Our Values (People) 103-2 103-3 The management approach and its components 2018 Social Responsibility Report, pages 6, 28 (Supporting our People) Code of Professional Conduct, page 4 (Creating a working environment that inspires and motivates our people) Evaluation of the management approach 2018 Social Responsibility Report, page 28, (Supporting our People) We’ve received several Awards and Recognitions related to employee development 401-2 Benefits 2018 Social Responsibility Report, page 26, 28 (Example parental leave, “other” programs) As noted in our Social Responsibility Report, our people are central to everything we do. We are committed to building a diverse firm, fostering an inclusive culture, and supporting our people in an unrivaled environment. This extends to the benefits we provide. Benefits provided to full-time employees include, among others i, life insurance; ii. health care; iii. disability and invalidity coverage; iv. parental leave; v. retirement provision; Others (e.g., Mind Matters, to support mental health and well-being). All (100%) of FTEs have access to relevant benefits according to their location, regional regulations, role and other factors. McKinsey & Company 12 2018 GRI Index > Material Topics Employee development (2 of 2) Disclosure Description Reference or additional information 404-1 Average hours of training per year per employee About Us > Overview As noted on our website, we invest more than $600 million of our firm’s resources annually in knowledge development, learning and capability building. A core learning journey exists for each role at McKinsey, comprised of in-person, virtual, and digital solutions. McKinsey colleagues also have access to elective, on-demand learning and participate in formal and informal learning events. In 2018, colleagues in client-facing roles participated in an average of 47 hours of firm-led training per year, while colleagues in internal roles participated in an average of 14 hours of training per year, in addition to training opportunities offered by individual locations and practices. Training participation does not vary materially by gender. 404-3 Percentage of employees receiving regular performance and career development reviews Feedback and learning is an important part of people development at McKinsey. With few exceptions (e.g., for Medical or Educational Leave), 100% of FTEs receive a regular performance and career development review, both ad hoc and formally (at least annually). McKinsey & Company 13 2018 GRI Index > Material Topics Diversity and inclusion Disclosure 103-1 Description Explanation of the material topic and its Boundary Reference or additional information See “Materiality” Participant Page, UN Global Compact. 103-2 103-3 405-1 Code of Professional Conduct, page 4 (Inclusion and Diversity) The management approach and its components 2018 Social Responsibility Report, pages 6, 23-28 (Fostering an Inclusive Environment) Code of Professional Conduct, page 4 (Creating a working environment that inspires and motivates our people) Supplier Code of Conduct, page 3 (Inclusion and Diversity) Evaluation of the management approach 2018 Social Responsibility Report, page 28, (Supporting our People) We’ve received several Awards and Recognitions related to employees and diversity. Diversity of governance bodies and employees About Us > Diversity and Inclusion McKinsey & Company 14 2018 GRI Index > Material Topics Human rights Disclosure 103-1 Description Explanation of the material topic and its Boundary Reference or additional information See “Materiality” Participant Page, UN Global Compact 103-2 103-3 412-12 The management approach and its components 2018 Social Responsibility Report, page 54 (Human Rights Policy) Code of Professional Conduct, page 5 (Human Rights), 8 (Seeking advice and raising concerns) Evaluation of the management approach 2018 Social Responsibility Report, page 54, (Human Rights) Supplier Code of Conduct, page 3 (Human Rights) Employee training on human rights policies or procedures 2018 Social Responsibility Report, page 52-54 All new hires are required to read McKinsey’s Code of Professional Conduct and participate in an in- person onboarding session where they learn about our values, which address key human rights issues such as inclusion, discrimination, and harassment. In addition, all McKinsey colleagues are required to review our core policies annually – including those related to human rights – and certify that they will comply with those policies. All McKinsey colleagues take a program of mandatory Professional Standards & Risk learning modules annually. And, each colleague’s core learning curriculum includes training on topics related to diversity and inclusion and personal conduct – such as unconscious bias, inclusive leadership, psychological safety, sponsoring diverse colleagues, mental health, sexual harassment and bullying. We do not have a breakdown of hours focused specifically on Human Rights training. McKinsey & Company 15 2018 GRI Index > Material Topics Community engagement Disclosure 103-1 Description Explanation of the material topic and its Boundary Reference or additional information See “Materiality” 2018 Social Responsibility Report, pages 40-50 (Partnerships) 103-2 103-3 413-1 The management approach and its components About Us: Social Responsibility 2018 Social Responsibility Report, pages 40-50 (Partnerships) Code of Professional Conduct, page 5 (Societal impact of our activities) Evaluation of the management approach Operations with local community engagement, impact assessments, and development programs 2018 Social Responsibility Report, page 40 (Partnerships) 2018 Social Responsibility Report, page 40-50, especially 42 (Supporting Nonprofits) McKinsey & Company 16 2018 GRI Index > Material Topics Supplier sustainability and diversity Disclosure 103-1 Description Explanation of the material topic and its Boundary Reference or additional information See “Materiality” Participant Page, UN Global Compact Supplier Code of Conduct, page 3 103-2 103-3 414-1 308-1 The management approach and its components 2018 Social Responsibility Report, page 57 (Working with Suppliers) Evaluation of the management approach 2018 Social Responsibility Report, page 57, (Working with Suppliers) Percentage of new suppliers that were screened using social criteria Percentage of new suppliers that were screened using environmental criteria 2018 Social Responsibility Report, page 57, (Working with Suppliers) As described in our 2018 Social Responsibility Report, all (100%) suppliers are expected to adhere to our Supplier Code of Conduct. We screen new suppliers for social criteria, including upholding human rights and operating workplaces free of discrimination. Also see our Modern Slavery Statement. 2018 Social Responsibility Report, page 57, (Working with Suppliers) As described in our 2018 Social Responsibility Report, all (100%) suppliers are expected to adhere to our Supplier Code of Conduct, which includes environmental criteria, including managing the environmental footprint. McKinsey & Company 17 2018 GRI Index > Material Topics Data privacy and security Disclosure Description Reference or additional information 103-1 103-2 103-3 418-1 Explanation of the material topic and its Boundary See “Materiality” 2018 Social Responsibility Report, page 55-56 The management approach and its components 2018 Social Responsibility Report, page 55-56 Code of Professional Conduct, page 3 (Client confidential information), page 4 (Our colleagues’ personal information), page 6 (Data security and protection) Supplier Code of Conduct, page 3 (Data Privacy and Security) Evaluation of the management approach 2018 Social Responsibility Report, page 55-56 Substantiated complaints concerning breaches of customer privacy and losses of customer data 2018 Social Responsibility Report, page 55-56 As described in our report, we have extensive practices in place to ensure data privacy. For example, systems and controls are designed to meet ISO/IEC 27001 standards, in combination with industry best practices. Our security operations center ensures a high level of information security for McKinsey’s applications (internal and external), systems, and all related data by providing best-in-class security- incident detection, analysis, containment, and mitigation. Complaints, if any, are considered confidential to our firm. McKinsey & Company 18"

    dict_list = obj.extract_ner(text)
    print(dict_list)
    # dict_list1 = obj.extract_weight(text)
    # print(dict_list1)
    # print(dict_list.keys())
    # for md in dict_list1:
    #     print(md)
